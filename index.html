<!-- Atualizado com as correções solicitadas -->

<!-- index.html -->
<!-- (sem alteração estrutural, apenas script corrigido para esconder links se logado) -->
<!-- Adicione ao final do <body> do index.html -->
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const usuario = JSON.parse(localStorage.getItem("usuario"));
    if (usuario) {
      const linkLogin = document.getElementById("linkLogin");
      const linkCadastro = document.getElementById("linkCadastro");
      if (linkLogin) linkLogin.style.display = "none";
      if (linkCadastro) linkCadastro.style.display = "none";
    }
  });
</script>

<!-- catalogo.html -->
<script>
  const produtos = [
    { nome: "Bolo de cenoura", descricao: "Bolo de cenoura...", preco: 2.5, imagem: "d1.jpg" },
    { nome: "Bolo no pote", descricao: "Bolo no pote...", preco: 2.5, imagem: "d2.jpg" },
    { nome: "Mini bolo", descricao: "Mini bolo...", preco: 2.5, imagem: "d3.jpg" },
    { nome: "Pudim", descricao: "Pudim...", preco: 3.0, imagem: "d4.jpg" }
  ];

  const produtosContainer = document.getElementById("produtos");

  produtos.forEach((produto) => {
    const div = document.createElement("div");
    div.classList.add("produto");
    div.innerHTML = `
      <img src="${produto.imagem}" alt="${produto.nome}" />
      <h3>${produto.nome}</h3>
      <p>${produto.descricao}</p>
      <p><strong>R$ ${produto.preco.toFixed(2)}</strong></p>
      <button onclick='adicionarAoCarrinho(${JSON.stringify(produto)})'>Adicionar ao carrinho</button>
    `;
    produtosContainer.appendChild(div);
  });

  function adicionarAoCarrinho(produto) {
    let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
    const existente = carrinho.find(item => item.nome === produto.nome);
    if (existente) {
      existente.quantidade += 1;
    } else {
      produto.quantidade = 1;
      carrinho.push(produto);
    }
    localStorage.setItem("carrinho", JSON.stringify(carrinho));
    alert(`${produto.nome} adicionado ao carrinho!`);
  }
</script>

<!-- carrinho.html -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = { ... };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
  const usuarioLogado = JSON.parse(localStorage.getItem("usuario")) || null;
  const carrinhoContainer = document.getElementById("carrinho");
  const finalizarBtn = document.getElementById("finalizarPedido");

  function renderCarrinho() {
    carrinhoContainer.innerHTML = "";
    if (carrinho.length === 0) {
      carrinhoContainer.innerHTML = "<p>O carrinho está vazio.</p>";
      return;
    }

    let total = 0;
    carrinho.forEach((item, index) => {
      if (!item.quantidade) item.quantidade = 1;
      const div = document.createElement("div");
      div.innerHTML = `
        <strong>${item.nome}</strong> - R$ ${item.preco.toFixed(2)} x 
        <input type="number" min="1" value="${item.quantidade}" style="width: 50px" data-index="${index}" class="quantidadeInput">
        = R$ ${(item.preco * item.quantidade).toFixed(2)}
        <br><br>
      `;
      carrinhoContainer.appendChild(div);
      total += item.preco * item.quantidade;
    });

    const totalDiv = document.createElement("div");
    totalDiv.innerHTML = `<hr><strong>Total: R$ ${total.toFixed(2)}</strong>`;
    carrinhoContainer.appendChild(totalDiv);

    document.querySelectorAll(".quantidadeInput").forEach(input => {
      input.addEventListener("change", (e) => {
        const index = e.target.dataset.index;
        carrinho[index].quantidade = parseInt(e.target.value) || 1;
        localStorage.setItem("carrinho", JSON.stringify(carrinho));
        renderCarrinho();
      });
    });
  }

  if (carrinhoContainer && finalizarBtn) {
    renderCarrinho();
    finalizarBtn.addEventListener("click", () => {
      if (usuarioLogado) {
        const pedidoRef = push(ref(db, "pedidos"));
        set(pedidoRef, {
          usuarioId: usuarioLogado.id,
          carrinho,
          data: new Date().toISOString()
        });
        alert("Pedido finalizado!");
        localStorage.removeItem("carrinho");
        window.location.href = "pagamento.html";
      } else {
        alert("Faça login antes de finalizar o pedido.");
        window.location.href = "login.html";
      }
    });
  }
</script>

<!-- pagamento.html -->
<script>
  setTimeout(() => {
    fetch("https://formsubmit.co/ajax/SEU_EMAIL@email.com", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: "Novo pedido recebido no Caseirinhos da Ne!",
        assunto: "Pedido confirmado"
      })
    }).then(() => {
      alert("Pagamento confirmado e email enviado!");
      window.location.href = "index.html";
    }).catch(() => {
      alert("Erro ao enviar email, mas pagamento confirmado.");
      window.location.href = "index.html";
    });
  }, 3000);
</script>
